<!DOCTYPE html>
<meta charset="utf-8">
<script src="https://d3js.org/d3.v7.js"></script>
<div>
  <form id="filter-form">
    <label for="min-value">Minimum Value:</label>
    <input type="number" name="min-value" id="min-value" value="0">
    <button type="submit">Apply Filter</button>
  </form>
</div>
<div id="my_dataviz"></div>
<script>
  const margin = {top: 10, right: 30, bottom: 40, left: 100},
      width = 460 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;
  const svg = d3.select("#my_dataviz")
    .append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            `translate(${margin.left}, ${margin.top})`).style("opacity", 0);
  d3.csv("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum_header.csv").then(function(data) {
    let minValue = 0; // default filter value
    const x = d3.scaleLinear()
      .domain([0, d3.max(data, d => d.Value)])
      .range([0, width]);
    svg.append("g")
      .attr("transform", `translate(0, ${height})`)
      .call(d3.axisBottom(x))
      .selectAll("text")
        .attr("transform", "translate(-10,0)rotate(-45)")
        .style("text-anchor", "end");
    const y = d3.scaleBand()
      .range([0, height])
      .domain(data.map(d => d.Country))
      .padding(1);
    svg.append("g")
      .call(d3.axisLeft(y));
    const lines = svg.selectAll(".line")
      .data(data)
      .enter()
      .append("line")
        .attr("x1", x(0))
        .attr("y1", d => y(d.Country))
        .attr("x2", d => x(d.Value))
        .attr("y2", d => y(d.Country))
        .attr("stroke", "grey")
        .attr("stroke-dasharray", "3,3")
        .attr("stroke-dashoffset", "3");
    const circles = svg.selectAll(".circle")
      .data(data)
      .enter()
      .append("circle")
        .attr("cx", d => x(d.Value))
        .attr("cy", d => y(d.Country))
        .attr("r", 7)
        .style("fill", "#69b3a2")
        .attr("stroke", "black")
        .on("mouseover", function(d) {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("r", 10)
            .style("fill", "#ff8000")
            .attr("stroke-width", 2);
        })
        .on("mouseout", function() {
          d3.select(this)
            .transition()
            .duration(200)
            .attr("r", 7)
            .style("fill", "#69b3a2")
            .attr("stroke-width", 1);
        });
    svg.transition()
      .duration(1000)
      .style("opacity", 1);
    // add event listener for filter form submission
    document.getElementById("filter-form").addEventListener("submit", function(event) {
      event.preventDefault();
      // get selected filter value
      const minValueInput = document.getElementById("min-value");
      minValue = parseInt(minValueInput.value);
      // update data and redraw graph
      const filteredData = data.filter(d => d.Value >= minValue);
      y.domain(filteredData.map(d => d.Country));
      lines.data(filteredData)
        .transition()
        .duration(1000)
        .attr("y1", d => y(d.Country))
        .attr("x2", d => x(d.Value))
        .attr("y2", d => y(d.Country));
      circles.data(filteredData)
        .transition()
        .duration(1000)
        .attr("cy", d => y(d.Country))
        .attr("cx", d => x(d.Value));
      svg.select(".y-axis")
        .transition()
        .duration(1000)
        .call(d3.axisLeft(y));
    });
  });
</script>


